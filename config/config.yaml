# Database
database:
  schema_path: "data/db_schema.json"
  selected_aliases: ["A", "AI", "PC", "ISC", "II", "PC_OZ", "OZ", "OV"]

# Paths
paths:
  data_raw: "data/raw/"
  data_processed: "data/processed/"
  models: "models/"
  logs: "logs/"

# Target e colonne
target:
  column: "AI_Prezzo_Ridistribuito"

# Preprocessing parametri
preprocessing:
  # ==========================================
  # CONTROLLO STEP ABILITAZIONE/DISABILITAZIONE
  # ==========================================
  steps:
    enable_specific_columns_removal: true
    enable_constant_columns_removal: true
    enable_cramers_analysis: true  
    enable_auto_numeric_conversion: true
    enable_correlation_removal: true
    enable_advanced_encoding: true
    enable_feature_scaling: true
    enable_log_transformation: true
    enable_outlier_detection: true
    enable_pca: false
  
  # ==========================================
  # CONFIGURAZIONI PULIZIA DATI
  # ==========================================
  # Colonne specifiche da rimuovere (non conoscibili a priori)
  columns_to_remove: ['A_Id', 'A_Codice', 'A_Prezzo', 'AI_Id']
  
  # Soglia per rimozione colonne costanti (% di valori uguali)
  constant_column_threshold: 0.95
  
  # Soglia per conversione automatica a numerico (% di conversioni valide)
  auto_numeric_threshold: 0.8
  
  # ==========================================
  # CONFIGURAZIONI CORRELAZIONI E FILTERING
  # ==========================================
  # Temporal split per evitare data leakage temporale
  use_temporal_split: true
  year_column: "A_AnnoStipula"  # Colonna anno per split temporale
  month_column: "A_MeseStipula"  # Colonna mese per split temporale
  
  # Soglie correlazione
  cramer_threshold: 0.95
  corr_threshold: 0.95
  
  # ==========================================
  # CONFIGURAZIONI ENCODING
  # ==========================================
  # Encoding
  low_cardinality_threshold: 10
  high_cardinality_max: 100
  
  # ==========================================
  # CONFIGURAZIONI OUTLIER DETECTION
  # ==========================================
  # Outliers - MIGLIORATO: Stratificazione per categoria
  outlier_strategy: "category_stratified"  # "global" | "category_stratified"
  category_column: "AI_IdCategoriaCatastale"  # Colonna per stratificazione
  alternative_category_column: "CC_Id"  # Fallback se prima non disponibile
  
  # Parametri outlier detection per categoria
  z_threshold: 2.5
  iqr_multiplier: 1.5
  isolation_contamination: 0.05
  min_methods_outlier: 2
  min_samples_per_category: 30  # Minimo campioni per fare detection
  
  # Parametri fallback globale (se categoria non disponibile)
  global_z_threshold: 3.0
  global_iqr_multiplier: 1.5
  global_isolation_contamination: 0.1
  
  # ==========================================
  # CONFIGURAZIONI PCA
  # ==========================================
  # PCA - CORRETTA gestione variance threshold
  use_pca: false
  pca_variance_threshold: 0.95  # 0-1 per % varianza, >1 per num componenti fisso
  
  # ==========================================
  # CONFIGURAZIONI SPLIT
  # ==========================================
  # Split
  val_size: 0.22
  test_size: 0.1
  random_state: 42
  
  # Stratificazione split (per target continuo) - DISABILITATA per temporal split
  use_stratified_split: false  # Incompatibile con temporal split
  stratification_quantiles: 5  # Divide target in 5 quantili per stratificazione

# Training parametri
training:
  # Cross-validation
  cv_folds: 5
  use_time_series_cv: true  # Usa TimeSeriesSplit invece di KFold per temporal data
  
  # Optimization metrics
  optimization_metric: 'neg_root_mean_squared_error'  # Metrica unificata per training e CV
  optimization_direction: 'minimize'  # Direzione ottimizzazione Optuna: 'minimize' o 'maximize'
  
  # Model ranking metrics  
  ranking_metric: 'Val_RMSE'  # Metrica per ranking finale dei modelli
  ranking_ascending: true  # Ordinamento: true per minimizzare, false per massimizzare
  
  # ==========================================
  # ESEMPI DI CONFIGURAZIONE PER DIVERSE METRICHE:
  # ==========================================
  # Per ottimizzare R² (coefficiente di determinazione):
  # optimization_metric: 'r2'
  # optimization_direction: 'maximize' 
  # ranking_metric: 'Val_R2'
  # ranking_ascending: false
  #
  # Per ottimizzare RMSE (Root Mean Squared Error):
  # optimization_metric: 'neg_root_mean_squared_error'
  # optimization_direction: 'minimize'
  # ranking_metric: 'Val_RMSE'
  # ranking_ascending: true
  
  # Optuna optimization
  n_trials: 100
  optuna_timeout: 7200  # 2 ore in secondi
  optuna_pruning_percentile: 25
  
  # Parallelization
  n_jobs: -1
  
  # Random state
  random_state: 42

# Modelli da addestrare
models:
  # Baseline models
  baseline:
    linear_regression: true
    ridge: true
    lasso: true
    elastic_net: true
    decision_tree: true
    knn: true
    svr: true
  
  # Advanced models (con ottimizzazione Optuna)
  advanced:
    random_forest: true
    gradient_boosting: true
    xgboost: true
    catboost: true
    lightgbm: true
    hist_gradient_boosting: true
  
  # Ensemble models
  ensemble:
    voting_regressor: true
    stacking_regressor: true
  
# Logging
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: "logs/pipeline.log"

# Esecuzione pipeline
execution:
  steps:
    - retrieve_data
    - build_dataset
    - preprocessing
    - training
    - evaluation
  
  force_reload: true  # Se true reload dei dati anche se già presenti

# Validation e monitoring
validation:
  # Analisi outliers post-detection
  generate_outlier_analysis: true
  outlier_analysis_plots: true
  
  # Performance monitoring per categoria
  category_performance_analysis: true
  min_samples_category_analysis: 50
  
  # Residual analysis
  residual_analysis: true
  residual_plots: true

# Quality checks
quality_checks:
  # Verifica data leakage
  check_temporal_leakage: true
  check_target_leakage: true
  
  # Verifica distribuzione categorie tra split
  check_category_distribution: true
  max_category_drift: 0.05  # Max differenza % tra train/val/test
  
  # Feature stability
  check_feature_stability: true
  max_feature_drift: 0.1
  
  # Controlli specifici per temporal split
  validate_temporal_split: true
  min_temporal_gap_months: 1  # Minimo gap temporale in mesi tra train/val/test